# Option Pattern

Handle absence of value without `null`.

## Why Option?

```typescript
// ❌ Null - easy to forget check
const user = await findUser(id) // User | null
console.log(user.email) // Can crash!

// ✅ Option - forced handling
const result = await findUser(id) // Result<Option<User>>
match(result.value, {
  Some: (user) => console.log(user.email),
  None: () => console.log('Not found')
})
```

## API

```typescript
import { Option, match } from '@packages/ddd-kit'

// Present value
const some = Option.some({ id: '1', name: 'Alice' })
some.isSome()   // true
some.unwrap()   // { id: '1', name: 'Alice' }

// Absent value
const none = Option.none<User>()
none.isNone()   // true
// none.unwrap() // Throws!
```

## Pattern Matching

```typescript
import { match } from '@packages/ddd-kit'

const message = match(userOption, {
  Some: (user) => `Hello, ${user.name}!`,
  None: () => 'User not found'
})
```

## Useful Methods

```typescript
// map - transform if present
userOption.map(user => user.name) // Option<string>

// flatMap - chain Options
userOption.flatMap(user => findManager(user.managerId))

// unwrapOr - default value
userOption.unwrapOr(guestUser)

// filter - filter by predicate
userOption.filter(user => user.age >= 18)
```

## In Repositories

```typescript
async findById(id: UUID): Promise<Result<Option<User>>> {
  const row = await db.query.users.findFirst({ where: eq(users.id, id.value) })
  if (!row) return Result.ok(Option.none())
  return Result.ok(Option.some(UserMapper.toDomain(row).value))
}
```

## In Use Cases

```typescript
async execute(userId: string): Promise<Result<User>> {
  const result = await this.userRepo.findById(UUID.createFrom(userId).value)
  if (result.isFailure) return Result.fail(result.error)

  return match(result.value, {
    Some: (user) => Result.ok(user),
    None: () => Result.fail(new NotFoundException('User not found'))
  })
}
```

## Rules

### ✅ Do
```typescript
return Result.ok(Option.none())        // Explicit absence
return Result.ok(Option.some(user))    // Explicit presence
match(option, { Some: ..., None: ... }) // Pattern matching
option.unwrapOr(defaultValue)          // Safe default
```

### ❌ Don't
```typescript
return null                // Use Option.none()
option.unwrap()           // Without checking isSome()
option.match({ ... })     // match is external function
```

## Next Steps

- [Result Pattern](/docs/core-concepts/result)
- [Value Objects](/docs/core-concepts/value-objects)
