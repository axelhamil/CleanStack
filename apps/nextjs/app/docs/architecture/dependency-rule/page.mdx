# Dependency Rule

## The Rule

**All dependencies point INWARD toward the Domain.**

```
╔════════════════════════════════════╗
║ Adapters                           ║
║ ✅ Can import: Application, Domain ║
║ ✅ Frameworks allowed              ║
╚═══════════════╦════════════════════╝
                ║
╔═══════════════╩════════════════════╗
║ Application                        ║
║ ✅ Can import: Domain, ddd-kit     ║
║ ❌ Cannot import: Adapters         ║
╚═══════════════╦════════════════════╝
                ║
╔═══════════════╩════════════════════╗
║ Domain (Core)                      ║
║ ✅ Can import: ddd-kit ONLY        ║
║ ❌ Cannot import: anything else    ║
╚════════════════════════════════════╝
```

## Why?

### Testability
Domain is 100% testable without DB/framework:
```typescript
describe('Email', () => {
  it('rejects invalid format', () => {
    expect(Email.create('invalid').isFailure).toBe(true)
  })
})
```

### Easy Changes
Replace Drizzle→Prisma: only touch Adapters.
```typescript
// Application unchanged
export interface IUserRepository extends BaseRepository<User> { }

// Only create new adapter
export class PrismaUserRepository implements IUserRepository { }
```

## Rules by Layer

### Domain
```typescript
// ✅ Allowed
import { Entity, Result, UUID } from '@packages/ddd-kit'
import { Email } from './Email'

// ❌ Forbidden
import { db } from '@packages/drizzle'
import { NextRequest } from 'next/server'
import { z } from 'zod'
import { CreateUserUseCase } from '@/application/..'
```

### Application
```typescript
// ✅ Allowed
import { User } from '@/domain/user/User'
import type { IUserRepository } from '@/application/ports/IUserRepository'

// ❌ Forbidden
import { DrizzleUserRepository } from '@/adapters/..'
import { db } from '@packages/drizzle'
```

### Adapters
```typescript
// ✅ All allowed
import type { IUserRepository } from '@/application/ports/IUserRepository'
import { User } from '@/domain/user/User'
import { db } from '@packages/drizzle'
import { NextRequest } from 'next/server'
```

## Dependency Inversion

Application defines **what**, Adapters define **how**.

```typescript
// Application defines interface
export interface IUserRepository {
  create(user: User): Promise<Result<User>>
}

// Use Case depends on interface
export class CreateUserUseCase {
  constructor(private repo: IUserRepository) {}
}

// Adapter implements
export class DrizzleUserRepository implements IUserRepository { }

// DI wires them
container.bind('IUserRepository').toClass(DrizzleUserRepository)
```

## Checklist

Before commit:
- [ ] Domain imports only from `@packages/ddd-kit`
- [ ] Application imports only from Domain + its own ports
- [ ] Adapters implements Application ports
- [ ] `pnpm type-check` passes

## Next Steps

- [Layers](/docs/architecture/layers)
- [First Use Case](/docs/guides/first-use-case)
