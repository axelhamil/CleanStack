#!/bin/sh

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m' # No Color

print_header() {
    echo "\n${BOLD}${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo "${BOLD}${BLUE}   ğŸ” PRE-COMMIT CHECKS${NC}"
    echo "${BOLD}${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
}

print_success() {
    echo "${GREEN}âœ“ $1${NC}"
}

print_error() {
    echo "\n${RED}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    echo "${RED}${BOLD}âœ• $1${NC}"
    echo "${RED}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}\n"
}

print_footer() {
    echo "\n${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    if [ $1 -eq 0 ]; then
        echo "${BOLD}${GREEN}âœ… ALL PRE-COMMIT CHECKS PASSED${NC}"
    else
        echo "${BOLD}${RED}âŒ PRE-COMMIT CHECKS FAILED${NC}"
        echo "${RED}Please fix the errors above before committing.${NC}"
    fi
    echo "${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
}

print_header

# Run lint-staged
echo "${CYAN}â–¶ Running lint-staged...${NC}"
pnpm lint-staged
lint_staged_exit_code=$?

if [ $lint_staged_exit_code -ne 0 ]; then
    print_error "lint-staged failed"
    print_footer 1
    exit 1
fi
print_success "Code is formatted and linted"

# Type checking
echo "${CYAN}â–¶ Checking types...${NC}"
pnpm type-check
type_check_exit_code=$?

if [ $type_check_exit_code -ne 0 ]; then
    print_error "Type check failed"
    print_footer 1
    exit 1
fi
print_success "Types are valid"

print_footer 0
exit 0
